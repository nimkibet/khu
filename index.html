<!DOCTYPE html>
<html lang="en">
<head>
    <title>KENYA HIGHLANDS UNIVERSITY</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="data:,">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: white; min-height: 100vh; color: #050505; }
        .header { background: white; padding: 8px 16px; box-shadow: 0 2px 4px rgba(42, 7, 198, 0.1); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        .logo { font-size: 28px; font-weight: bold; color: #0bc311; }
        .nav { display: flex; gap: 8px; overflow-x: auto; padding: 4px 0; }
        .nav-btn { background: none; border: none; padding: 12px 16px; cursor: pointer; font-size: 15px; color: #65676b; border-radius: 8px; font-weight: 500; white-space: nowrap; }
        .nav-btn:hover { background: #f0f2f5; }
        .nav-btn.active { color: #1877f2; border-bottom: 3px solid #1877f2; }
        .container { max-width: 1400px; margin: 16px auto; padding: 0 16px; display: grid; grid-template-columns: 280px 1fr 320px; gap: 16px; }
        .sidebar { position: sticky; top: 72px; height: fit-content; }
        .sidebar-item { display: flex; align-items: center; padding: 12px; border-radius: 8px; cursor: pointer; margin-bottom: 4px; }
        .sidebar-item:hover { background: #e4e6eb; }
        .main-content { display: none; }
        .main-content.active { display: block; }
        .semester-banner { background: linear-gradient(135deg, #1877f2, #42b983); color: white; padding: 24px; border-radius: 8px; margin-bottom: 16px; text-align: center; }
        .create-post { background: white; border-radius: 8px; padding: 16px; margin-bottom: 16px; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #1877f2, #42b983); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; margin-right: 12px; }
        .post-input { flex: 1; background: #f0f2f5; border: none; border-radius: 24px; padding: 12px 16px; font-size: 15px; cursor: pointer; color: #65676b; }
        .post-card { background: white; border-radius: 8px; margin-bottom: 16px; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
        .post-header { display: flex; padding: 16px; }
        .post-info h4 { font-size: 15px; font-weight: 600; }
        .post-meta { font-size: 13px; color: #65676b; }
        .post-content { padding: 0 16px 12px; font-size: 15px; line-height: 1.5; }
        .course-card { background: white; border-radius: 8px; padding: 20px; margin-bottom: 16px; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
        .course-header { display: flex; justify-content: space-between; margin-bottom: 8px; }
        .course-badge { background: #1877f2; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; }
        .course-reg { color: #42b983; font-size: 12px; font-weight: 600; }
        .course-title { font-weight: 600; margin-bottom: 4px; }
        .course-info { font-size: 13px; color: #65676b; }
        .timetable-table { width: 100%; border-collapse: collapse; background: white; }
        .timetable-table th { background: #1877f2; color: white; padding: 12px; }
        .timetable-table td { border: 1px solid #e4e6eb; padding: 12px; text-align: center; }
        .class-item { background: linear-gradient(135deg, #1877f2, #42b983); color: white; border-radius: 4px; padding: 5px; font-size: 12px; }
        .campus-map { width: 100%; height: 600px; border: 1px solid #e2e8f0; border-radius: 12px; position: relative; background: #f8fafc; overflow: hidden; }
        .map-building { position: absolute; background: white; border: 2px solid #2563eb; border-radius: 8px; padding: 10px; font-size: 11px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; text-align: center; transition: all 0.2s; }
        .map-building:hover { transform: translateY(-3px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); background: #f0f9ff; z-index: 50; }
        .message { margin-bottom: 16px; display: flex; gap: 10px; width: 100%; }
        .message.user { flex-direction: row-reverse; }
        .message-avatar { width: 35px; height: 35px; border-radius: 50%; background: linear-gradient(135deg, #1877f2, #42b983); color: white; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 700; flex-shrink: 0; }
        .message-bubble { max-width: 75%; padding: 12px 16px; border-radius: 18px; font-size: 15px; line-height: 1.5; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .message.ai .message-bubble { background: #f0f2f5; color: #1c1e21; border-bottom-left-radius: 4px; }
        .message.user .message-bubble { background: #1877f2; color: white; border-bottom-right-radius: 4px; }
        .chat-input-area { padding: 16px; border-top: 1px solid #e2e8f0; display: flex; gap: 12px; background: white; }
        .chat-input { flex: 1; background: #f1f5f9; border: 1px solid #e2e8f0; border-radius: 24px; padding: 12px 20px; font-size: 15px; outline: none; }
        .chat-input:focus { border-color: #1877f2; background: white; box-shadow: 0 0 0 3px rgba(24, 119, 242, 0.1); }
        .chat-send { background: #1877f2; color: white; border: none; padding: 0 24px; border-radius: 24px; font-weight: 600; cursor: pointer; }
        .chat-send:hover { background: #166fe5; }
        .chat-send:disabled { background: #cbd5e1; cursor: not-allowed; }
        #floatingLogoutBtn { position: fixed; bottom: 30px; right: 30px; background-color: #e41e3f; color: white; border: none; border-radius: 50px; padding: 12px 20px; display: flex; align-items: center; gap: 8px; cursor: pointer; box-shadow: 0 4px 12px rgba(228, 30, 63, 0.3); z-index: 999; font-weight: 600; }
        #floatingLogoutBtn:hover { background-color: #c61a36; transform: scale(1.05); }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; padding: 20px; border-radius: 8px; width: 90%; max-width: 500px; }
        @media (max-width: 1100px) { .container { grid-template-columns: 1fr; } .sidebar { display: none; } }
        @media (max-width: 600px) { .logout-text { display: none; } #floatingLogoutBtn { padding: 15px; bottom: 20px; right: 20px; } }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" style="position: fixed; inset: 0; background: white; z-index: 2000; display: flex; align-items: center; justify-content: center; flex-direction: column;">
        <div class="logo" style="margin-bottom: 30px; font-size: 32px;">KHU Portal Login</div>
        <div style="width: 100%; max-width: 400px; padding: 20px;">
            <div style="margin-bottom: 20px;">
                <label style="display: block; font-size: 14px; font-weight: 600; color: #65676b; margin-bottom: 8px;">Registration Number</label>
                <input type="text" id="USER_REG" placeholder="e.g. BCSF/001/2022" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px;">
            </div>
            <div style="margin-bottom: 25px;">
                <label style="display: block; font-size: 14px; font-weight: 600; color: #65676b; margin-bottom: 8px;">Password (ID/Birth Certificate Number)</label>
                <input type="password" id="USER_ID" placeholder="Enter ID or Birth Certificate No." style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px;">
            </div>
            <button onclick="handleLogin()" style="width: 100%; padding: 14px; background: #1877f2; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Login to Portal</button>
            <p id="loginError" style="color: #e41e3f; font-size: 13px; margin-top: 15px; text-align: center; display: none;">Invalid credentials.</p>
        </div>
    </div>

    <!-- Header -->
    <div class="header">
        <div class="logo">KHU-Be your brother's keeper</div>
        <div class="nav">
            <button class="nav-btn active" onclick="showSection('feed', event)">Feed</button>
            <button class="nav-btn" onclick="showSection('courses', event)">Courses</button>
            <button class="nav-btn" onclick="showSection('timetable', event)">Timetable</button>
            <button class="nav-btn" onclick="showSection('map', event)">Campus Map</button>
            <button class="nav-btn" onclick="showSection('ai', event)">Highlands AI</button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-item">
                <span class="sidebar-icon">üë§</span>
                <div>
                    <div id="displayUserName" style="font-weight: 600; font-size: 15px;">Guest User</div>
                    <div id="displayUserCourse" style="font-size: 13px; color: #65676b;">Not Logged In</div>
                    <button onclick="logout()" style="background: none; border: none; color: #e41e3f; font-size: 12px; cursor: pointer; padding: 0; margin-top: 5px; text-decoration: underline;">Logout</button>
                </div>
            </div>
            <div class="sidebar-item">üìä GPA: 3.8</div>
            <div class="sidebar-item" id="adminLink" onclick="location.href='admin.html'" style="cursor: pointer; display: none;">‚öôÔ∏è Admin Panel</div>
        </div>

        <!-- Main Content -->
        <div>
            <!-- Feed Section -->
            <div id="feed" class="main-content active">
                <div class="semester-banner"><h2>Fall 2025 Semester</h2><p>Registration for Spring 2026 starts Dec 15</p></div>
                <div class="create-post">
                    <div style="display: flex; align-items: center;">
                        <div class="user-avatar" id="postAvatar">GU</div>
                        <input type="text" class="post-input" placeholder="What's on your mind?" onclick="openPostModal()" readonly>
                    </div>
                </div>
                <div id="postsContainer">
                    <!-- Posts will be loaded dynamically from Firestore -->
                </div>
            </div>

            <!-- Courses Section -->
            <div id="courses" class="main-content">
                <h1 style="margin-bottom: 20px;">Registered Courses</h1>
                <div id="coursesContainer"></div>
            </div>

            <!-- Timetable Section -->
            <div id="timetable" class="main-content">
                <div style="background: white; border-radius: 8px; padding: 20px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                    <h2 style="margin-bottom: 16px;">Weekly Schedule - Fall 2025</h2>
                    <table class="timetable-table">
                        <thead><tr><th>Time</th><th>Monday</th><th>Tuesday</th><th>Wednesday</th><th>Thursday</th><th>Friday</th></tr></thead>
                        <tbody>
                            <tr><td>7:00 AM - 1:00 PM</td><td></td><td><div class="class-item"><div>CS302</div><div>Room LH-4</div></div></td><td></td><td><div class="class-item"><div>CS302</div><div>Room LH-4</div></div></td><td></td></tr>
                            <tr><td>1:00 PM - 4:00 PM</td><td><div class="class-item"><div>CS301</div><div>Room CS-101</div></div></td><td></td><td><div class="class-item"><div>CS301</div><div>Room CS-101</div></div></td><td></td><td><div class="class-item"><div>CS303</div><div>Lab B-12</div></div></td></tr>
                            <tr><td>4:00 PM - 7:00 PM</td><td><div class="class-item"><div>CS308</div><div>Room CS-103</div></div></td><td></td><td><div class="class-item"><div>CS308</div><div>Room CS-103</div></div></td><td></td><td><div class="class-item"><div>CS304</div><div>Lab C-12</div></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Map Section -->
            <div id="map" class="main-content">
                <h2 style="margin-bottom: 16px;">Campus Map</h2>
                <div class="campus-map" id="campusMap"></div>
            </div>

            <!-- AI Section -->
            <div id="ai" class="main-content">
                <div style="background: white; border-radius: 8px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); overflow: hidden;">
                    <div style="padding: 16px; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 12px;">
                        <div class="user-avatar" style="background: #1877f2;">AI</div>
                        <h3>Highlands AI</h3>
                    </div>
                    <div id="chatMessages" style="height: 400px; overflow-y: auto; padding: 16px;"></div>
                    <div class="chat-input-area">
                        <input type="text" class="chat-input" id="chatInput" placeholder="Ask anything...">
                        <button class="chat-send" id="sendBtn">Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Post Modal -->
    <div id="postModal" class="modal">
        <div class="modal-content">
            <h3 style="margin-bottom: 16px;">Create Post</h3>
            <textarea id="postContent" style="width: 100%; height: 120px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-family: inherit; resize: none;" placeholder="What's on your mind?"></textarea>
            <div style="display: flex; justify-content: space-between; margin-top: 16px;">
                <span id="charCount" style="color: #65676b; font-size: 13px;">0/280</span>
                <div>
                    <button onclick="closePostModal()" style="padding: 8px 16px; border: 1px solid #ddd; border-radius: 6px; background: white; cursor: pointer; margin-right: 8px;">Cancel</button>
                    <button onclick="handleCreatePost()" style="padding: 8px 16px; background: #1877f2; color: white; border: none; border-radius: 6px; cursor: pointer;">Post</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Logout Button -->
    <button id="floatingLogoutBtn" onclick="logout()" title="Logout">
        <span style="font-size: 20px;">‚ûî</span>
        <span class="logout-text">Logout</span>
    </button>

    <!-- Firebase Configuration - MUST be before Firebase SDK -->
    <script>
        window.FIREBASE_API_KEY = "AIzaSyDGDjCx7eUgpurU64fH9NkhxVErei8Ug6I";
        window.FIREBASE_AUTH_DOMAIN = "khu-portal.firebaseapp.com";
        window.FIREBASE_PROJECT_ID = "khu-portal";
        window.FIREBASE_STORAGE_BUCKET = "khu-portal.firebasestorage.app";
        window.FIREBASE_MESSAGING_SENDER_ID = "31515014542";
        window.FIREBASE_APP_ID = "1:31515014542:web:a02fb67aa28164b4c4e0df";
    </script>

    <!-- Firebase SDK Scripts (must load after config) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>

    <!-- Feed functionality -->
    <script src="feed.js"></script>
</body>

    <script>
        // Course data
        const courses = [
            { code: "CS301", title: "Advanced Algorithms", instructor: "Prof. James Otieno", units: ["Complexity Analysis", "Dynamic Programming", "Graph Algorithms", "NP-Completeness"] },
            { code: "CS302", title: "Web Development", instructor: "Dr. Sarah Kimani", units: ["HTML/CSS/JS", "React Framework", "Node.js & Express", "Database Integration"] },
            { code: "CS303", title: "Database Systems", instructor: "Dr. Michael Ochieng", units: ["SQL & NoSQL", "Normalization", "Indexing", "Transactions"] },
            { code: "CS304", title: "Software Engineering", instructor: "Prof. Grace Wanjiku", units: ["Agile Methodology", "Design Patterns", "Testing Strategies", "DevOps"] }
        ];

        // Building data for campus map
        const buildings = [
            { name: "Main Library", left: 20, top: 20, width: 120, height: 80 },
            { name: "CS Building", left: 45, top: 35, width: 100, height: 70 },
            { name: "Admin Block", left: 10, top: 60, width: 110, height: 60 },
            { name: "Sports Complex", left: 70, top: 15, width: 130, height: 90 }
        ];

        // Login handler
        async function handleLogin() {
            const regElement = document.getElementById('USER_REG');
            const idElement = document.getElementById('USER_ID');
            
            if (!regElement || !idElement) {
                console.error('Login elements not found');
                return;
            }

            const regNo = regElement.value.trim();
            const idNumber = idElement.value.trim();

            console.log("Attempting login for:", regNo);

            const errorMsg = document.getElementById('loginError');
            if (errorMsg) errorMsg.style.display = 'none';

            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ regNo, idNumber })
                });
                
                console.log("Response status:", response.status);
                const data = await response.json();
                console.log("Response data:", data);
                
                if (data.success) {
                    const user = data.user;
                    const sessionData = {
                        ...user,
                        userType: user.isAdmin ? 'admin' : 'student',
                        loginTime: Date.now()
                    };
                    localStorage.setItem('khu_user', JSON.stringify(sessionData));
                    
                    // Hide login page
                    document.getElementById('loginPage').style.display = 'none';
                    
                    // Update UI
                    updateProfileUI(user);
                    
                    // Redirect based on role
                    if (user.isAdmin || user.role === 'admin') {
                        window.location.href = 'admin.html';
                    } else {
                        showSection('feed', { target: document.querySelector('.nav-btn') });
                    }
                } else {
                    if (errorMsg) {
                        errorMsg.style.display = 'block';
                        errorMsg.textContent = data.error || "Invalid credentials.";
                    }
                }
            } catch (err) {
                console.error("Login error:", err);
                if (errorMsg) {
                    errorMsg.style.display = 'block';
                    errorMsg.textContent = "Connection failed. Check your internet.";
                }
            }
        }

        // Show section
        function showSection(sectionId, event) {
            document.querySelectorAll('.main-content').forEach(s => s.classList.remove('active'));
            const target = document.getElementById(sectionId);
            if (target) target.classList.add('active');
            
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            if (event && event.target) {
                event.target.classList.add('active');
            }
        }

        // Update profile UI
        function updateProfileUI(user) {
            const nameDisplay = document.getElementById('displayUserName');
            const courseDisplay = document.getElementById('displayUserCourse');
            
            if (nameDisplay) nameDisplay.textContent = user.firstName + ' ' + user.lastName;
            if (courseDisplay) courseDisplay.textContent = user.course || 'Student';
            
            // Show admin link for admins
            if (user.isAdmin || user.role === 'admin') {
                document.getElementById('adminLink').style.display = 'flex';
            }
        }

        // Logout
        function logout() {
            localStorage.removeItem('khu_user');
            window.location.reload();
        }

        // Post modal
        function openPostModal() {
            document.getElementById('postModal').classList.add('active');
        }

        function closePostModal() {
            document.getElementById('postModal').classList.remove('active');
            document.getElementById('postContent').value = '';
            document.getElementById('charCount').textContent = '0/280';
        }

        function submitPost() {
            const content = document.getElementById('postContent').value.trim();
            if (!content) {
                alert('Please enter some content for your post.');
                return;
            }
            
            const user = JSON.parse(localStorage.getItem('khu_user') || '{}');
            const name = user.firstName ? user.firstName + ' ' + user.lastName : 'Guest User';
            const regNo = user.regNumber || '';
            
            // Call the API to save the post
            fetch('/api/posts', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    content: content,
                    authorName: name,
                    regNo: regNo
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Create post card locally
                    const postCard = document.createElement('div');
                    postCard.className = 'post-card';
                    postCard.innerHTML = `
                        <div class="post-header">
                            <div class="user-avatar">${name.split(' ').map(w => w[0]).join('').toUpperCase().substring(0, 2)}</div>
                            <div class="post-info"><h4>${name}</h4><div class="post-meta">Just now</div></div>
                        </div>
                        <div class="post-content">${escapeHtml(content)}</div>
                    `;
                    
                    const container = document.getElementById('postsContainer');
                    if (container) {
                        container.insertBefore(postCard, container.firstChild);
                    }
                    closePostModal();
                } else {
                    alert('Failed to save post: ' + (data.error || 'Unknown error'));
                }
            })
            .catch(err => {
                console.error('Submit post error:', err);
                alert('Failed to save post. Please try again.');
            });
        }

        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Render courses
        function renderCourses() {
            const container = document.getElementById('coursesContainer');
            container.innerHTML = '';
            courses.forEach((c, index) => {
                const el = document.createElement('div');
                el.className = 'course-card';
                el.innerHTML = `
                    <div class="course-header">
                        <span class="course-badge">${c.code}</span>
                        <span class="course-reg">Registered</span>
                    </div>
                    <div class="course-title">${c.title}</div>
                    <div class="course-info">Instructor: ${c.instructor}</div>
                `;
                container.appendChild(el);
            });
        }

        // Render map
        function renderMap() {
            const map = document.getElementById('campusMap');
            if (!map) return;
            map.innerHTML = '';
            buildings.forEach(b => {
                const el = document.createElement('div');
                el.className = 'map-building';
                el.style.left = b.left + '%';
                el.style.top = b.top + '%';
                el.style.width = b.width + 'px';
                el.style.height = b.height + 'px';
                el.textContent = b.name;
                el.onclick = () => alert(`${b.name}\nClick to view details`);
                map.appendChild(el);
            });
        }

        // AI Chat
        function addMessage(text, sender) {
            const chatMessages = document.getElementById('chatMessages');
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${sender}`;
            msgDiv.innerHTML = `
                <div class="message-avatar">${sender === 'user' ? 'ME' : 'AI'}</div>
                <div class="message-bubble">${text}</div>
            `;
            chatMessages.appendChild(msgDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function sendMessage() {
            const chatInput = document.getElementById('chatInput');
            const userText = chatInput.value.trim();
            if (!userText) return;
            
            addMessage(userText, 'user');
            chatInput.value = '';
            
            // Simple AI response
            let response = "I'm your Highlands AI assistant. I can help with courses, schedule, and campus info.";
            const lower = userText.toLowerCase();
            if (lower.includes('hi') || lower.includes('hello')) {
                response = "Hello! How can I help you today?";
            } else if (lower.includes('course')) {
                response = `You are registered for: ${courses.map(c => c.code).join(', ')}. Which one would you like to know more about?`;
            } else if (lower.includes('gpa')) {
                response = "Your current GPA is 3.8. Keep up the great work!";
            } else if (lower.includes('where')) {
                response = "Check the Campus Map section for building locations.";
            }
            
            setTimeout(() => addMessage(response, 'ai'), 500);
        }

        // Check login status on load
        function checkLoginStatus() {
            const savedUser = localStorage.getItem('khu_user');
            if (savedUser) {
                try {
                    const user = JSON.parse(savedUser);
                    const thirtyMinutes = 30 * 60 * 1000;
                    const now = Date.now();
                    if (now - user.loginTime < thirtyMinutes) {
                        document.getElementById('loginPage').style.display = 'none';
                        updateProfileUI(user);
                        if (user.isAdmin || user.role === 'admin') {
                            document.getElementById('adminLink').style.display = 'flex';
                        }
                    } else {
                        logout();
                    }
                } catch (e) {
                    console.error('Error parsing user:', e);
                }
            }
        }

        // Character count for post
        document.getElementById('postContent')?.addEventListener('input', function() {
            const count = this.value.length;
            document.getElementById('charCount').textContent = count + '/280';
            document.getElementById('charCount').style.color = count > 280 ? '#e41e3f' : '#65676b';
        });

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            renderCourses();
            renderMap();
            
            // Chat send button
            document.getElementById('sendBtn')?.addEventListener('click', sendMessage);
            document.getElementById('chatInput')?.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendMessage();
            });
            
            // AI Greeting
            const chatMessages = document.getElementById('chatMessages');
            if (chatMessages && chatMessages.children.length === 0) {
                const user = JSON.parse(localStorage.getItem('khu_user') || '{}');
                const name = user.firstName || 'Student';
                addMessage(`Hello ${name}! I'm Highlands AI. I can help with courses, schedules, and campus questions. How can I assist you?`, 'ai');
            }
        });
    </script>

</html>
